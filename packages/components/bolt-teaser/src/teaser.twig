{# Schema Validation #}
{% set schema = bolt.data.components["@bolt-components-teaser"].schema %}
{% if enable_json_schema_validation %}
  {{ validate_data_schema(schema, _self)|raw }}
{% endif %}

{# Variables #}
{% set this = init(schema) %}
{% set attributes = create_attribute(attributes|default({})) %}


{# Array of classes based on the defined + default props #}
{% set classes = [
  'c-bolt-teaser',
  this.data.horizontal.value ? 'c-bolt-teaser--horizontal' : '',
] %}




<article {{ attributes.addClass(classes) }}>
  {#
    TODO:
    - whats wrong with ratio?
    - make sure this uses the validation variables when it can.
    - refactor the stylesheet.
    - make the schema.
    - make some good demos.
---
    - premium tag position math, make it configurable.
      - fixed width.
      - up to 12 characters?
  #}

  {% if this.data.horizontal.value %}
    {% set _ratio = '1/1' %}
  {% else %}
    {% set _ratio = '16/9' %}
  {% endif %}

  <div class="c-bolt-teaser__thumbnail">
    <div class="c-bolt-teaser__thumbnail-image">
      {% if image %}
        {% include "@bolt-components-ratio/ratio.twig" with {
          children: image,
          ratio: _ratio
        } only %}
      {% else %}
        {% include "@bolt-components-ratio/ratio.twig" with {
          ratio: _ratio
        } only %}
      {% endif %}
    </div>

    {% if premium %}
      <div class="c-bolt-teaser__thumbnail-premium">
        Premium
      </div>
    {% endif %}

    {% if type %}
      <div class="c-bolt-teaser__thumbnail-type">
        {% if type == 'video' %}
          {% include "@bolt-components-icon/icon.twig" with {
            name: "asset-video",
            background: "square",
            size: "small",
            color: "yellow",
          } only %}
        {% elseif type == 'pdf' %}
          {% include "@bolt-components-icon/icon.twig" with {
            name: "asset-media",
            background: "square",
            size: "small",
            color: "yellow",
          } only %}
        {% elseif type == 'article' %}
          {% include "@bolt-components-icon/icon.twig" with {
            name: "asset-text",
            background: "square",
            size: "small",
            color: "yellow",
          } only %}
        {% endif %}
      </div>
    {% endif %}

    {% if this.data.description.value and not this.data.show_description.value %}
      <div class="c-bolt-teaser__thumbnail-description-wrapper" aria-hidden="true">
        <div class="c-bolt-teaser__thumbnail-description">
          <p>
            {{ this.data.description.value|length > 100 ? this.data.description.value|slice(0, 100) ~ '...' : this.data.description.value }}
          </p>
        </div>
      </div>
    {% endif %}
  </div>

  <div class="c-bolt-teaser__content">
    <div class="c-bolt-teaser__meta-action-content">
      <div class="o-bolt-grid o-bolt-grid--flex">
        {% if meta_items %}
          {% for item in meta_items %}
            <div class="o-bolt-grid__cell u-bolt-flex-shrink">
              <div class="c-bolt-teaser__meta-item">
                  {{ item }}
              </div>
            </div>
          {% endfor %}
        {% endif %}

        <div class="o-bolt-grid__cell u-bolt-flex-grow">
          {% if share_menu %}
            {% set share_button %}
              {% set _share_popover_trigger %}
                  {% include '@bolt-components-link/link.twig' with {
                    text: 'Share',
                    icon: {
                      name: 'share',
                      position: 'before',
                    },
                    type: 'button',
                    isHeadline: true,
                  } only %}
              {% endset %}
              {% include '@bolt-components-popover/popover.twig' with {
                trigger: _share_popover_trigger,
                content: share_menu,
                spacing: 'none',
              } only %}
            {% endset %}
          {% endif %}

          {% if like_button or share_button %}
            <div class="c-bolt-teaser__meta-action-items">
              {% if like_button %}
                <div class="c-bolt-teaser__meta-action-item">
                  {{ like_button }}
                </div>
              {% endif %}
              {% if share_button %}
                <div class="c-bolt-teaser__meta-action-item">
                  {{ share_button }}
                </div>
              {% endif %}
            </div>
          {% endif %}
        </div>
      </div>
    </div>

    {% if headline %}
      {% set icon_chevron_right %}
        {% include '@bolt-components-icon/icon.twig' with {
          name: 'chevron-right',
        } only %}
      {% endset %}

      <div class="c-bolt-teaser__headline">
        {% set _action %}
          {% include '@bolt-elements-text-link/text-link.twig' with {
            content: headline.text,
            expand_click_target: true,
            icon_after: icon_chevron_right,
            reversed_underline: true,
            attributes: headline.link_attributes
          } only %}
        {% endset %}

        {% include '@bolt-components-headline/headline.twig' with {
          text: _action,
          tag: 'h2',
          size: 'large'
        } only %}
      </div>
    {% endif %}

    {% if this.data.description.value %}
      <div class="c-bolt-teaser__description {{ this.data.show_description.value ? '' : 'u-bolt-visuallyhidden' }}">
        <p>
          {{ this.data.description.value }}
        </p>
      </div>
    {% endif %}

    {% if chip_list %}
      <div class="c-bolt-teaser__chips">
        {% include '@bolt-components-chip-list/chip-list.twig' with chip_list only %}
      </div>
    {% endif %}
  </div>

</article>
