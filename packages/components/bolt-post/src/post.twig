{# Schema Validation #}
{% set schema = bolt.data.components['@bolt-components-post'].schema %}
{% if enable_json_schema_validation %}
  {{ validate_data_schema(schema, _self)|raw }}
{% endif %}

{# Variables #}
{% set this = init(schema) %}
{% set attributes = create_attribute(attributes|default({})) %}
{% set _post_id = bolt.data.config.env == 'test' ? 'js-test-target' : 'js-bolt-post-' ~ random() %}

{# Array of classes based on the defined + default props #}
{% set classes = [
  'c-bolt-post',
  _post_id,
] %}

<article {{ attributes.addClass(classes) }}>
  <div class="c-bolt-post__flag">
    {% if signifier %}
      <div class="c-bolt-post__flag-signifier" aria-hidden="true">
        {{ signifier }}
      </div>
    {% endif %}
    <div class="c-bolt-post__flag-heading">
      {% if headline.link_attributes %}
        {% set _linked_text %}
          {% include '@bolt-elements-text-link/text-link.twig' with {
            content: headline.text,
            reversed_underline: true,
            expand_click_target: true,
            attributes: headline.link_attributes
          } only %}
        {% endset %}
      {% endif %}
      {% include '@bolt-components-headline/headline.twig' with {
        text: headline.link_attributes ? _linked_text : headline.text,
        tag: headline.tag,
        size: headline.size,
      } only %}
    </div>
    <div class="c-bolt-post__flag-content">
      {% if meta_items %}
        <ul class="c-bolt-post__meta">
          {% for item in meta_items %}
            <li class="c-bolt-post__meta__item">{{ item }}</li>
          {% endfor %}
        </ul>
      {% endif %}
      {% if this.data.more_info %}
        <div class="c-bolt-post__more-info">
          {% set _icon_chevron_right %}
            {% include '@bolt-components-icon/icon.twig' with {
              name: 'chevron-right',
            } only %}
          {% endset %}
          {% set _read_more_link %}
            {{ 'Read More'|t }}{{ _icon_chevron_right|spaceless }}
          {% endset %}
          {% include '@bolt-components-headline/text.twig' with {
            text: this.data.more_info.value ~ ' &hellip; ' ~ _read_more_link|spaceless,
            tag: 'p',
            size: 'small',
          } only %}
        </div>
      {% endif %}
      {% if this.data.warning %}
        <div class="c-bolt-post__warning">
          {% set _icon_warning %}
            {% include '@bolt-components-icon/icon.twig' with {
              name: 'warning',
              color: 'yellow',
            } only %}
          {% endset %}
          {% include '@bolt-components-headline/text.twig' with {
            text: _icon_warning ~ this.data.warning.value,
            tag: 'p',
            size: 'small',
          } only %}
        </div>
      {% endif %}
    </div>
    {% if status %}
      <ul class="c-bolt-post__flag-status">
        {% if status.solved %}
          <li class="c-bolt-post__flag-status__item">
            <span class="c-bolt-post__flag-status__icon c-bolt-post__flag-status__icon--solved" aria-hidden="true">
              {% include '@bolt-components-icon/icon.twig' with {
                name: 'check-solid',
              } only %}
            </span>
            {{ status.solved_label ? status.solved_label|t : 'Solved'|t }}
          </li>
        {% endif %}
        {% if status.locked %}
          <li class="c-bolt-post__flag-status__item">
            <span class="c-bolt-post__flag-status__icon c-bolt-post__flag-status__icon--locked" aria-hidden="true">
              {% include '@bolt-components-icon/icon.twig' with {
                name: 'lock',
              } only %}
            </span>
            {{ status.locked_label ? status.locked_label|t : 'Locked'|t }}
          </li>
        {% endif %}
        {% if status.replies %}
          <li class="c-bolt-post__flag-status__item">
            <span class="c-bolt-post__flag-status__number">{{ status.replies }}</span> {{ 'Replies'|t }}
          </li>
        {% endif %}
        {% if status.views %}
          <li class="c-bolt-post__flag-status__item">
            <span class="c-bolt-post__flag-status__number">{{ status.views }}</span> {{ 'Views'|t }}
          </li>
        {% endif %}
      </ul>
    {% endif %}
  </div>
  {% if show_actions %}
    {% if show_actions.reply %}
      {% set _icon_reply %}
        {% include '@bolt-components-icon/icon.twig' with {
          name: 'reply',
          size: 'small',
        } only %}
      {% endset %}
      {% set _reply_menu_item = {
        content: 'Reply'|t,
        icon_before: _icon_reply,
      } %}
    {% endif %}
    {% if show_actions.favorite %}
      {% set _icon_heart %}
        {% include '@bolt-components-icon/icon.twig' with {
          name: 'heart',
          size: 'small',
          color: status.favorited ? 'pink' : 'auto',
        } only %}
      {% endset %}
      {% set _favorite_menu_item = {
        content: status.favorited ? 'Remove from favorites'|t : 'Favorite'|t,
        icon_before: _icon_heart,
      } %}
    {% endif %}
    {% if show_actions.subscribe %}
      {% set _icon_eye %}
        {% include '@bolt-components-icon/icon.twig' with {
          name: status.subscribed ? 'eye-off' : 'eye',
          size: 'small',
        } only %}
      {% endset %}
      {% set _subscribe_menu_item = {
        content: status.subscribed ? 'Unsubscribed'|t : 'Subscribe'|t,
        icon_before: _icon_eye,
      } %}
    {% endif %}
    <div class="c-bolt-post__actions">
      {% set _popover_trigger %}
        {% include '@bolt-components-button/button.twig' with {
          text: 'Action menu'|t,
          size: 'xsmall',
          style: 'tertiary',
          iconOnly: true,
          icon: {
            name: 'more',
            position: 'before',
          },
        } only %}
      {% endset %}
      {% set _popover_content %}
        {% include '@bolt-components-menu/menu.twig' with {
          title: 'More actions'|t,
          items: [
            _reply_menu_item,
            _favorite_menu_item,
            _subscribe_menu_item,
          ],
        } only %}
      {% endset %}
      {% include '@bolt-components-popover/popover.twig' with {
        trigger: _popover_trigger,
        content: _popover_content,
        spacing: 'none',
        boundary: '.' ~ _post_id,
        placement: 'bottom-end',
      } only %}
    </div>
  {% endif %}
</article>
