{# Schema Validation #}
{% set schema = bolt.data.components['@bolt-components-post'].schema %}
{% if enable_json_schema_validation %}
  {{ validate_data_schema(schema, _self)|raw }}
{% endif %}

{# Variables #}
{% set this = init(schema) %}
{% set attributes = create_attribute(attributes|default({})) %}
{% set _headline_link_attributes = create_attribute(headline.link_attributes|default({})) %}
{% set _id = 'js-bolt-post-' ~ random() %}

{# Array of classes based on the defined + default props #}
{% set classes = [
  'c-bolt-post',
  disabled ? 'c-bolt-post--disabled' : '',
] %}

<div {{ attributes.addClass(classes)|without('id') }} id="{{ _id }}">
  {% if icon %}
    <div class="c-bolt-post__media" aria-hidden="true">
      {{ icon }}
    </div>
  {% endif %}
  <div class="c-bolt-post__content">
    <div class="c-bolt-post-info">
      <div class="c-bolt-post-info__heading">
        {% if _headline_link_attributes %}
          {% set _linked_text %}
            {% include '@bolt-elements-text-link/text-link.twig' with {
              content: headline.text,
              reversed_underline: true,
              expand_click_target: true,
              attributes: _headline_link_attributes
            } only %}
          {% endset %}
        {% endif %}
        {% include '@bolt-components-headline/headline.twig' with {
          text: _headline_link_attributes ? _linked_text : headline.text,
          tag: headline.tag,
          size: headline.size,
        } only %}
      </div>
      {% if meta_items %}
        <ul class="c-bolt-post-info__meta">
          {% for item in meta_items %}
            <li class="c-bolt-post-info__meta__item">{{ item }}</li>
          {% endfor %}
        </ul>
      {% endif %}
      {% if summary %}
        <div class="c-bolt-post-info__summary">
          {% set _icon_chevron_right %}
            {% include '@bolt-components-icon/icon.twig' with {
              name: 'chevron-right',
            } only %}
          {% endset %}
          {% set _read_more_link %}
            {{ 'Read More'|t }}{{ _icon_chevron_right|spaceless }}
          {% endset %}
          {% include '@bolt-components-headline/text.twig' with {
            text: summary ~ ' &hellip; ' ~ _read_more_link|spaceless,
            tag: 'p',
            size: 'small',
          } only %}
        </div>
      {% endif %}
      {% if warning %}
        <div class="c-bolt-post-info__warning">
          {% set _icon_warning %}
            {% include '@bolt-components-icon/icon.twig' with {
              name: 'warning',
              color: 'yellow',
            } only %}
          {% endset %}
          {% include '@bolt-components-headline/text.twig' with {
            text: _icon_warning ~ warning,
            tag: 'p',
            size: 'small',
          } only %}
        </div>
      {% endif %}
    </div>
    {% if status %}
      <ul class="c-bolt-post-status">
        {% if status.solved %}
          <li class="c-bolt-post-status__item">
            <span class="c-bolt-post-status__icon c-bolt-post-status__icon--solved" aria-hidden="true">
              {% include '@bolt-components-icon/icon.twig' with {
                name: 'check-solid',
              } only %}
            </span>
            {{ status.solved_label ? status.solved_label|t : 'Solved'|t }}
          </li>
        {% endif %}
        {% if status.locked %}
          <li class="c-bolt-post-status__item">
            <span class="c-bolt-post-status__icon c-bolt-post-status__icon--locked" aria-hidden="true">
              {% include '@bolt-components-icon/icon.twig' with {
                name: 'lock',
              } only %}
            </span>
            {{ status.locked_label ? status.locked_label|t : 'Locked'|t }}
          </li>
        {% endif %}
        {% if status.replies %}
          <li class="c-bolt-post-status__item">
            <span class="c-bolt-post-status__number">{{ status.replies }}</span> {{ 'Replies'|t }}
          </li>
        {% endif %}
        {% if status.views %}
          <li class="c-bolt-post-status__item">
            <span class="c-bolt-post-status__number">{{ status.views }}</span> {{ 'Views'|t }}
          </li>
        {% endif %}
      </ul>
    {% endif %}
  </div>
  {% if show_actions %}
    {% set _icon_reply %}
      {% include '@bolt-components-icon/icon.twig' with {
        name: 'reply',
        size: 'small',
      } only %}
    {% endset %}
    {% set _icon_heart %}
      {% include '@bolt-components-icon/icon.twig' with {
        name: 'heart',
        size: 'small',
        color: status.favorited ? 'pink' : 'auto',
      } only %}
    {% endset %}
    {% set _icon_eye %}
      {% include '@bolt-components-icon/icon.twig' with {
        name: status.subscribed ? 'eye-off' : 'eye',
        size: 'small',
      } only %}
    {% endset %}
    <div class="c-bolt-post__actions">
      {% set _popover_trigger %}
        {% include '@bolt-components-button/button.twig' with {
          text: 'Action menu'|t,
          size: 'small',
          style: 'tertiary',
          iconOnly: true,
          icon: {
            name: 'more',
            position: 'before',
          },
        } only %}
      {% endset %}
      {% set _popover_content %}
        {% include '@bolt-components-menu/menu.twig' with {
          title: 'More actions'|t,
          items: [
            {
              content: 'Reply'|t,
              icon_before: _icon_reply,
            },
            {
              content: status.favorited ? 'Remove from favorites'|t : 'Favorite'|t,
              icon_before: _icon_heart,
            },
            {
              content: status.subscribed ? 'Unsubscribed'|t : 'Subscribe'|t,
              icon_before: _icon_eye,
            },
          ]
        } only %}
      {% endset %}
      {% include '@bolt-components-popover/popover.twig' with {
        trigger: _popover_trigger,
        content: _popover_content,
        spacing: 'none',
        boundary: '#' ~ _id,
        placement: 'bottom-end',
      } only %}
    </div>
  {% endif %}
</div>
