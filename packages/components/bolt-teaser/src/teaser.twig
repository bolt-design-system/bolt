{% set schema = bolt.data.components["@bolt-components-teaser"].schema %}

{% if enable_json_schema_validation %}
  {{ validate_data_schema(schema, _self) | raw }}
{% endif %}

{# Variables #}
{% set this = init(schema) %}
{% set inner_attributes = create_attribute({}) %}

{# Array of classes based on the defined + default props #}
{% set classes = [
  "c-bolt-teaser",
] %}
{# {% set classes = [
  "c-bolt-teaser",
  disabled ? "c-bolt-teaser--disabled" : "",
] %} #}

{#
  Sort classes passed in via attributes into two groups:
  1. Those that should be applied to the inner tag (namely, "is-" and "has-" classes)
  2. Those that should be applied to the outer custom element (everything else EXCEPT c-bolt-* classes, which should never be passed in via attributes)
#}
{% set outer_classes = [] %}
{% set inner_classes = classes %}

{% for class in attributes["class"] %}
  {% if class starts with "is-" or class starts with "has-" %}
    {% set inner_classes = inner_classes|merge([class]) %}
  {% elseif class starts with "c-bolt-" == false %}
    {% set outer_classes = outer_classes|merge([class]) %}
  {% endif %}
{% endfor %}

<bolt-teaser
  {% if outer_classes %} class="{{ outer_classes|join(' ') }}" {% endif %}
  {{ this.props|without("class") }}
>
  {# <replace-with-children {{ inner_attributes.addClass(inner_classes) }}>
  </replace-with-children> #}

{#
  TODO:
  - meta / share block
    - like toggler
    - reference post
  - remove bolt-stack. refer to post?
#}

  {% if image %}
    <bolt-teaser-media class="c-bolt-teaser-media">

      {% include '@bolt-components-image/image.twig' with image only %}

      {% if premium %}
        <bolt-teaser-premium class="c-bolt-teaser-premium">
          Premium
        </bolt-teaser-premium>
      {% endif %}

      {% if type %}
        <bolt-teaser-type>
          {% if type == 'video' %}
            {% include "@bolt-components-icon/icon.twig" with {
              name: "asset-video",
              background: "square",
              size: "small",
              color: "yellow",
            } only %}
          {% elseif type == 'pdf' %}
            {% include "@bolt-components-icon/icon.twig" with {
              name: "asset-media",
              background: "square",
              size: "small",
              color: "yellow",
            } only %}
          {% elseif type == 'article' %}
            {% include "@bolt-components-icon/icon.twig" with {
              name: "asset-text",
              background: "square",
              size: "small",
              color: "yellow",
            } only %}
          {% endif %}
        </bolt-teaser-type>
      {% endif %}

      {% if this.data.description.value %}
        <bolt-teaser-description-wrapper class="c-bolt-teaser-description-wrapper">
          <bolt-teaser-description class="c-bolt-teaser-description">
            <p>
              {{ this.data.description.value|length > 100 ? this.data.description.value|slice(0, 100) ~ '...' : this.data.description.value }}
            </p>
          </bolt-teaser-description>
        </bolt-teaser-description-wrapper>
      {% endif %}

    </bolt-teaser-media>
  {% endif %}

  <bolt-stack spacing="xsmall" class="c-bolt-teaser--meta-share">
    <div class="o-bolt-grid o-bolt-grid--flex o-bolt-grid--matrix">
      <div class="o-bolt-grid__cell u-bolt-flex-shrink">
          <small>15 min read</small>
      </div>
      <div class="o-bolt-grid__cell u-bolt-flex-shrink">
          <small>
            {% include '@bolt-components-icon/icon.twig' with {
              name: 'eye',
            } only %}
            27 views
          </small>
      </div>
      <div class="o-bolt-grid__cell u-bolt-width-6/12 u-bolt-flex-grow">
        {% set like_button %}
          <small>
            {% include '@bolt-components-link/link.twig' with {
              text: 'Like',
              icon: {
                name: 'heart',
                position: 'before',
              },
              type: 'button',
              isHeadline: true,
            } only %}
          </small>
        {% endset %}
        {% set share_button %}
          {% set popover_trigger %}
            <small>
              {% include '@bolt-components-link/link.twig' with {
                text: 'Share',
                icon: {
                  name: 'share',
                  position: 'before',
                },
                type: 'button',
                isHeadline: true,
              } only %}
            </small>
          {% endset %}
          {% set popover_content %}
            {% include '@bolt-components-share/share.twig' with {
              display: 'menu',
              text: 'Share this content',
              sources: [
                {
                  name: 'facebook',
                  url: 'https://www.facebook.com/sharer/sharer.php?u=https://pega.com&amp;src=sdkpreparse'
                },
                {
                  name: 'twitter',
                  url: 'https://twitter.com/intent/tweet?url=https://pega.com&text=Sample%20Share%20Text&via=pega&hashtags=boltDesignSystemRocks!'
                },
                {
                  name: 'linkedin',
                  url: 'https://www.linkedin.com/shareArticle?url=https://pega.com'
                },
                {
                  name: 'email',
                  url: 'mailto:?&body=Sample%20Text%20--%20https%3A//pega.com'
                }
              ],
              copy_to_clipboard: {
                text_to_copy: 'https://pega.com',
              },
            } only %}
          {% endset %}
          {% include "@bolt-components-popover/popover.twig" with {
            trigger: popover_trigger,
            content: popover_content,
            spacing: "none",
          } only %}
        {% endset %}

        {% include '@bolt-components-list/list.twig' with {
          display: 'inline',
          align: 'end',
          spacing: 'small',
          items: [
            like_button,
            share_button,
          ]
        } only %}
      </div>
    </div>
  </bolt-stack>

  {% if headline %}
    {% set icon_chevron_right %}
      {% include '@bolt-components-icon/icon.twig' with {
        name: 'chevron-right',
      } only %}
    {% endset %}
    <bolt-stack spacing="xsmall">
      {% set _action %}
        {% include '@bolt-elements-text-link/text-link.twig' with {
          content: headline.text,
          expand_click_target: true,
          icon_after: icon_chevron_right,
          reversed_underline: true,
          attributes: headline.link_attributes
        } only %}
      {% endset %}

      {% include '@bolt-components-headline/headline.twig' with {
        text: _action,
        tag: 'h2',
        size: 'large'
      } only %}
    </bolt-stack>
  {% endif %}

  {% if chip_list %}
    {% include '@bolt-components-chip-list/chip-list.twig' with chip_list only %}
  {% endif %}
</bolt-teaser>
